<!DOCTYPE html>
<html>
  <head>
    <title>{{ page.title }}</title>

    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />

    {% if page.lang %}
      <meta http-equiv="content-language" content="{{ page.lang }}">
    {% endif %}

    <link rel="stylesheet" type="text/css" href="/css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="/css/default.css" />
    <link rel="stylesheet" type="text/css" href="/css/syntax.css" />

    <link rel="alternate" type="application/rss+xml" href="/rss.xml"/>

    <link rel="icon" type="image/png" href="/favicon.gif" />

    <script src="/js/cash.min.js"></script>
    <script src="/js/axios.min.js"></script>
    <script src="/js/tmpl.min.js"></script>
    <script src="/js/trigger.js"></script>

    {% raw %}
    <script type="text/x-tmpl" id="template-comment">
      <div class="comment">
        <div class="user">
          <img src="{%# o.user.avatar_url %}" />
          <span>{%= o.user.login %}</span>
        </div>

        <div class="date">
          {%= o.created_at %}
        </div>

        <div class="body">
          {%# o.body_html %}
        </div>
      </div>
    </script>
    {% endraw %}

    {% if page.trigger %}
      <script>
        $(document).ready(function() {
          trigger({
            {% for trigger in page.trigger %}
              "{{trigger[0]}}": "{{trigger[1]}}",
            {% endfor %}
          });
        });
      </script>

      {% if page.comments %}
        <script>
          $(document).ready(function() {
            axios.get("https://api.github.com/repos/meh/meh.github.io/issues/{{ page.comments }}/comments", {
              headers: {
                "Accept": "application/vnd.github.3.full+json"
              }
            }).then(function(response) {
              return response.data.map(function(comment) {
                return $(tmpl("template-comment", comment).trim())
              });
            }).then(function(comments) {
              var comments = $('<div id="comments"></div>');

              comments.forEach(function(comment) {
                comment.appendTo(comments);
              });

              comments.appendTo($('#container'));
            })
            .catch(function() {
              console.warn("Who needs comments anyway?");
            })
          });
        </script>
      {% endif %}
    {% endif %}
  </head>

  <body>
    <div id="container">
      <div id="menu"><center>
        {% if page.menu %}
          {% for link in page.menu %}
            <span class="bracket">[</span><a href="{{ link.url }}">{{ link.text }}</a><span class="bracket">]</span>
          {% endfor %}
        {% else %}
          <span class="bracket">[</span><a href="/">cat words/*(ocmM-42[0,5])</a><span class="bracket">]</span>
          <span class="bracket">[</span><a href="/projects.html">cd projects</a><span class="bracket">]</span>
          <span class="bracket">[</span><a href="/random.html">cd random</a><span class="bracket">]</span>
          <span class="bracket">[</span><a href="/whereis.html">whereis meh</a><span class="bracket">]</span>
        {% endif %}
      </center></div>

      <hr class="menu-bottom"/>

      <div id="content">
        {{ content }}
      </div>
    </div>
  </body>
</html>
